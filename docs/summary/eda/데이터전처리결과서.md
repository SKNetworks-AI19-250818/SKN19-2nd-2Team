# 데이터전처리결과서 (컬럼별 EDA 해석)

작성 가이드(각 컬럼 공통 템플릿):
- 컬럼 설명(원 변수명/설명, 단위, 인코딩 규칙)
- 가설(금연과의 기대 관계) 및 근거
- 결측/이상치 처리 방법과 근거
- 분포/상관/교호작용 요약(대표 시각화 캡션 포함)
- 파생 변수 설계(정의, 임계값, 채택/제외 사유)
- 금연(churn)과의 관계 요약 및 해석 상의 주의점

## 상관 분석 요약(01_data_overview.ipynb 발췌)

<table>
  <tr>
    <td valign="top" style="width:50%">
      <strong>양의 상관계수</strong>
      <table>
        <thead>
          <tr><th>순위</th><th>변수명</th><th>상관계수</th><th>변수 의미</th></tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>smd_02z3</td><td>0.963292</td><td>최근1년금연시도여부</td></tr>
          <tr><td>2</td><td>smd_01z3</td><td>0.940259</td><td>금연계획</td></tr>
          <tr><td>3</td><td>smb_01z1</td><td>0.855602</td><td>매일흡연자하루흡연량</td></tr>
          <tr><td>4</td><td>sma_03z2</td><td>0.841061</td><td>일반담배현재흡연상태</td></tr>
          <tr><td>5</td><td>sma_37z1</td><td>0.343737</td><td>궐련형전자담배현재사용</td></tr>
          <tr><td>6</td><td>sma_36z1</td><td>0.316096</td><td>궐련형전자담배평생사용</td></tr>
          <tr><td>7</td><td>smb_11z1</td><td>0.292605</td><td>궐련형매일사용자하루사용량</td></tr>
          <tr><td>8</td><td>age</td><td>0.292371</td><td>만나이</td></tr>
          <tr><td>9</td><td>smb_03z1</td><td>0.224873</td><td>가끔흡연자일평균흡연량</td></tr>
          <tr><td>10</td><td>smb_02z1</td><td>0.223314</td><td>가끔흡연자월간흡연일수</td></tr>
          <tr><td>11</td><td>sma_11z2</td><td>0.180677</td><td>액상형전자담배현재사용</td></tr>
          <tr><td>12</td><td>sma_08z1</td><td>0.177574</td><td>액상형전자담배평생사용</td></tr>
          <tr><td>13</td><td>mtc_12c1</td><td>0.171099</td><td>잠자는데 발생한 문제_화장실 가려고 일어남</td></tr>
          <tr><td>14</td><td>smb_13z1</td><td>0.167065</td><td>궐련형가끔사용자일평균량</td></tr>
          <tr><td>15</td><td>smb_12z1</td><td>0.166137</td><td>궐련형가끔사용자월간일수</td></tr>
        </tbody>
      </table>
    </td>
    <td valign="top" style="width:50%">
      <strong>음의 상관계수</strong>
      <table>
        <thead>
          <tr><th>순위</th><th>변수명</th><th>상관계수</th><th>변수 의미</th></tr>
        </thead>
        <tbody>
          <tr><td>1</td><td>smb_06z1</td><td>-0.931736</td><td>과거흡연자하루평균흡연량</td></tr>
          <tr><td>2</td><td>smb_04z1</td><td>-0.931152</td><td>과거흡연자흡연기간_년</td></tr>
          <tr><td>3</td><td>smb_05z1</td><td>-0.930900</td><td>과거흡연자흡연기간_월</td></tr>
          <tr><td>4</td><td>smb_09z1</td><td>-0.694634</td><td>금연유지기간</td></tr>
          <tr><td>5</td><td>nua_01z2</td><td>-0.236455</td><td>아침식사빈도</td></tr>
          <tr><td>6</td><td>mtj_11z1</td><td>-0.222855</td><td>연간 치매선별검사 수진 여부</td></tr>
          <tr><td>7</td><td>sod_02z3</td><td>-0.220719</td><td>sod_02z3</td></tr>
          <tr><td>8</td><td>sca_01z1</td><td>-0.197668</td><td>sca_01z1</td></tr>
          <tr><td>9</td><td>mtj_05z2</td><td>-0.155501</td><td>인지장애 경험 여부</td></tr>
          <tr><td>10</td><td>drb_01z3</td><td>-0.151565</td><td>연간음주빈도</td></tr>
          <tr><td>11</td><td>hya_30z1</td><td>-0.149768</td><td>hya_30z1</td></tr>
          <tr><td>12</td><td>hya_14b2</td><td>-0.148698</td><td>hya_14b2</td></tr>
          <tr><td>13</td><td>hya_14a2</td><td>-0.145243</td><td>hya_14a2</td></tr>
          <tr><td>14</td><td>hya_14c2</td><td>-0.145211</td><td>hya_14c2</td></tr>
          <tr><td>15</td><td>hya_15z1</td><td>-0.144361</td><td>hya_15z1</td></tr>
        </tbody>
      </table>
    </td>
  </tr>
</table>

## 본 프로젝트 가설 요약
EDA와 모델링 단계에서 다음 가설을 순차 검증/보완합니다.

| 구분 | 주요 변수 예시 | 가설 (Hypothesis) |
| --- | --- | --- |
| 가구환경 | fma_14z1(월평균소득), nue_01z1(식품안정성) | H1 : 가구소득이 높고 식품안정성이 높은 가구일수록 금연성공률이 높을 것이다. |
| 음주행태 | drb_01z3(음주빈도), drb_03z1(1회 음주량), drb_04z1/05z1(폭음빈도), drg_01z3(금주계획) | H2 : 음주빈도가 높거나 폭음 빈도가 높은 사람은 금연성공률이 낮을 것이다.  \\ H3 : 절주·금주 계획이 있는 사람은 금연성공률이 높을 것이다. |
| 신체활동 | pha_04z1(고강도활동일수), pha_07z1(중강도활동일수), phb_01z1(걷기일수) | H4 : 신체활동 빈도가 높을수록 자기조절능력이 높아 금연성공률이 높을 것이다. |
| 식생활 | nua_01z2(아침식사빈도), nuc_02z1(영양표시 인지), nuc_03z1(영양표시 활용) | H5 : 아침식사 빈도가 적을수록 생활습관이 불규칙해 금연성공률이 낮을 것이다.  \\ H6 : 영양표시에 관심이 높은 사람은 건강의식이 높아 금연성공률이 높을 것이다. |
| 비만 및 체중조절 | oba_03z1(체중), obb_01z1(체중조절경험), obb_02c1(식사량조절) | H7 : 체중조절을 시도한 사람은 자기통제력이 높아 금연성공률이 높을 것이다. |
| 구강건강 | ora_01z1(주관적 구강건강), ord_01d2(점심 칫솔질 여부), ore_07z1(스케일링경험) | H8 : 구강건강이 좋거나 관리습관이 있는 사람일수록 금연성공률이 높을 것이다. |
| 정신건강 | mta_01z1(스트레스인지), mtb_01z1(우울감경험), mtc_17z1(수면시간) | H9 : 스트레스와 우울감이 높을수록 금연성공률이 낮을 것이다.  \\ H10 : 충분한 수면시간을 확보한 사람은 금연성공률이 높을 것이다. |
| 주관적건강/삶의질 | qoa_01z1(주관적건강), ql_c1200(EQ-5D지수) | H11 : 자신의 건강상태를 긍정적으로 인식할수록 금연성공률이 높을 것이다. |
| 보건기관 이용 | hma_01z3(보건기관 이용), sra_01z3(미충족의료) | H12 : 보건기관 이용률이 높을수록 금연캠페인 및 상담 노출 가능성이 커 금연성공률이 높을 것이다. |
| 교육 및 경제활동 | sob_01z1(학력), soa_06z2(직업), dr_a0400(음주지표와의 교차) | H13 : 교육수준과 직업 안정성이 높을수록 금연성공률이 높을 것이다. |

---

## 전처리 요약(preprocess.py 기준)

### 타깃 생성(make_target)
- 현재 흡연(currently_smoking): 다음 중 하나라도 만족하면 흡연 중으로 간주
  - `sma_03z2 ∈ {1,2}`(일반담배 현재 흡연) 또는 `sma_12z2 == 1`(액상형 전자담배 현재 사용) 또는 `sma_37z1 ∈ {1,2}`(궐련형 현재 사용)
- 과거 흡연(stop_smoked): 다음 중 하나라도 만족하면 과거 흡연 경험으로 간주
  - `sma_03z2 == 3`(과거흡연) 또는 `sma_12z2 == 2`(액상형 과거 사용) 또는 `sma_37z1 == 3`(궐련형 과거 사용)
- 금연 성공 타깃 `churn`
  - `(~currently_smoking) & stop_smoked` 이면 `1`, 그 외 `0`
  - 액상형 특이 케이스는 `Liquid_method2`로 후처리(최근 1달 사용일수>0인데 churn=1인 모순 정정)

### 'b' 문자 전처리(식별자/코드형)
- CSV 로딩시 몇몇 식별자/코드에 `b'0001'` 형태의 문자열이 포함됨 → `'` 기준 분리하여 실제 값만 사용
- 적용 컬럼: `exmprs_no`, `CTPRVN_CODE`, `SPOT_NO`(존재 시)

### 설문 특수코드(7/8/9 등) → NaN 처리 원칙
- 7=응답거부, 8=비해당, 9=모름(유사하게 77/777/… 확장 코드) → “결측”으로 간주하여 NaN으로 대체
- 이유: 대부분의 설문 항목은 범주형(예: 교육수준 1=무학, 2=서당, …, 10=대학원). 7/8/9는 유효한 범주가 아니라 비응답/비해당 상태를 뜻하므로 평균/최빈값 대치가 응답 의미를 왜곡함
- 범주형 해석 일관성을 위해 NaN 유지 후, 모델 단계에서 적절한 인코딩/결측 처리 전략 적용
- 적용 예시(일부):
  - 가구·구강·식생활 등: 값≥7 → NaN
  - 연간/월간 코드형: 값≥77 또는 ≥777 → NaN

### 노트북 예시
- 동일 원칙이 각 전처리 함수에서 일관 적용됨
  - 예: `preprocess_drink_physical()`에서 `drb_01z3`/`drb_03z1`의 특수코드 보정 및 `≥7/≥77` 기준 NaN 처리

### 병합 및 키 관리
- 각 파트 전처리 후 `exmprs_no`, `churn` 키 기준 외부조인으로 병합
- 최종 병합 크기와 제외 컬럼은 로그로 확인(전처리 추적성 확보)

---

## 가설 검증 테이블(초안)
실증 분석 단계에서 아래 표에 지표/방법/결과를 채워나갑니다.

| 구분 | 가설 | 검증 지표/방법 | 진행 상태 | 결과 요약 |
| --- | --- | --- | --- | --- |
| 가구환경 | H1 : 소득↑, 식품안정성↑ → 금연성공률↑ | 그룹별 성공률, 로지스틱 계수, SHAP | 진행중 |  |
| 음주행태 | H2 : 음주/폭음↑ → 금연성공률↓ | 교차표, ROC분석, SHAP | 진행중 |  |
| 음주행태 | H3 : 절주·금주 계획↑ → 금연성공률↑ | 오즈비, 부분의존도 | 진행중 |  |
| 신체활동 | H4 : 신체활동↑ → 금연성공률↑ | 상관/로지스틱/SHAP | 진행중 |  |
| 식생활 | H5/H6 | 그룹비교, 다변량 | 진행중 |  |
| 비만/체중 | H7 | 회귀계수, SHAP | 진행중 |  |
| 구강건강 | H8 | 그룹비교, 로지스틱 | 진행중 |  |
| 정신건강 | H9/H10 | 상관/다변량/SHAP | 진행중 |  |
| 삶의질 | H11 | 지수-성공률 관계 | 진행중 |  |
| 보건이용 | H12 | 이용여부×성공률 | 진행중 |  |
| 교육/경제 | H13 | 학력/직업×성공률, 계수 | 진행중 |  |
