# PDY Feature Engineering ë¶„ì„ ë¬¸ì„œ

**ì‘ì„±ì:** vfxpedia  
**ë¶„ì„ ëŒ€ìƒ:** `notebooks/team/modules/features_pdy.py`  
**ìƒì„± íŒŒìƒë³€ìˆ˜:** 2ê°œ  
**ë‹´ë‹¹ ì˜ì—­:** ì²´ì¤‘ì¡°ì ˆ/ì‹ ì²´í™œë™

---

## ğŸ“‹ ëª©ì°¨

1. [ê°œìš”](#ê°œìš”)
2. [ìƒì„±ëœ íŒŒìƒë³€ìˆ˜](#ìƒì„±ëœ-íŒŒìƒë³€ìˆ˜)
3. [ë³€ìˆ˜ë³„ ìƒì„¸ ë¶„ì„](#ë³€ìˆ˜ë³„-ìƒì„¸-ë¶„ì„)

---

## ê°œìš”

PDY íŒ€ì›ì´ ë‹´ë‹¹í•œ ëª¨ë“ˆì€ **ì²´ì¤‘ì¡°ì ˆ ë°©ë²•**ê³¼ **ì‹ ì²´í™œë™ ì ìˆ˜** ê´€ë ¨ ë³€ìˆ˜ë¥¼ ë‹¤ë£¹ë‹ˆë‹¤.

### í•µì‹¬ ì „ëµ

- ì²´ì¤‘ì¡°ì ˆ ë°©ë²• 3ê°€ì§€ ì¡°í•©
- ì‹ ì²´í™œë™ ê°•ë„ë³„ ê°€ì¤‘ì¹˜ ì ìš©
- í™œë™ ì ìˆ˜ ê¸°ë°˜ 4ë‹¨ê³„ ë¶„ë¥˜

---

## ìƒì„±ëœ íŒŒìƒë³€ìˆ˜

| ë²ˆí˜¸ | íŒŒìƒë³€ìˆ˜ëª… | ì›ë³¸ ë³€ìˆ˜ | íƒ€ì… | ì„¤ëª… |
|------|-----------|----------|------|------|
| 1 | `weight_control_method` | `obb_02a1`, `obb_02b1`, `obb_02d1` | ë¬¸ìì—´ | ì²´ì¤‘ì¡°ì ˆ ë°©ë²• ì¡°í•© |
| 2 | `activity_score_weight` | `pha_04z1`, `pha_06z1`, `phb_01z1` | ìˆ˜ì¹˜ | ê°€ì¤‘ í™œë™ ì ìˆ˜ |
| 2-1 | `activity_score` | `activity_score_weight` | ë²”ì£¼ | í™œë™ ìˆ˜ì¤€ (4ë‹¨ê³„) |

âš ï¸ ì¶”ê°€: `Liquid_method1`, `Liquid_method2` (ì•¡ìƒí˜• ë‹´ë°° ë¡œì§, í¡ì—° ê´€ë ¨ìœ¼ë¡œ ë³„ë„ ë¶„ë¥˜)

---

## ë³€ìˆ˜ë³„ ìƒì„¸ ë¶„ì„

### 1. weight_control_method (ì²´ì¤‘ì¡°ì ˆ ë°©ë²•)

**ëª©ì :** ì²´ì¤‘ì¡°ì ˆ ë°©ë²•ì´ ê±´ê°• ì˜ì‹ â†’ ê¸ˆì—° ì„±ê³µë¥ ì— ì˜í–¥

```python
def feature_weight_control_method(df_merge):
    cols = ['obb_02a1', 'obb_02b1', 'obb_02d1']
    # ["ì²´ì¤‘ì¡°ì ˆë°©ë²•_ìš´ë™", "ì²´ì¤‘ì¡°ì ˆë°©ë²•_ë‹¨ì‹", "ì²´ì¤‘ì¡°ì ˆë°©ë²•_ë¬´ì²˜ë°©ì•½ë¬¼"]

    # NaNì„ 'ë¹„ì‘ë‹µ'ìœ¼ë¡œ ëŒ€ì²´í•˜ê³ , ì„¸ ì¹¼ëŸ¼ì„ ì¡°í•©í•œ ë¬¸ìì—´ ìƒì„±
    df_merge["weight_control_method"] = (
        df_merge[cols]
        .fillna("no_response")          # NaN â†’ 'ë¹„ì‘ë‹µ'
        .astype(str)                    # ìˆ«ìë¥¼ ë¬¸ìì—´ë¡œ ë³€í™˜
        .agg("-".join, axis=1)          # 3ê°œ ê°’ì„ '-'ë¡œ ì—°ê²°
    )

    return df_merge
```

**ì›ë³¸ ë³€ìˆ˜:**
- `obb_02a1`: ì²´ì¤‘ì¡°ì ˆë°©ë²• - ìš´ë™ (1=ì˜ˆ, 2=ì•„ë‹ˆì˜¤)
- `obb_02b1`: ì²´ì¤‘ì¡°ì ˆë°©ë²• - ë‹¨ì‹ (1=ì˜ˆ, 2=ì•„ë‹ˆì˜¤)
- `obb_02d1`: ì²´ì¤‘ì¡°ì ˆë°©ë²• - ë¬´ì²˜ë°©ì•½ë¬¼ (1=ì˜ˆ, 2=ì•„ë‹ˆì˜¤)

**ë³€í™˜ ë¡œì§:**
- 3ê°œ ê°’ì„ "-"ë¡œ ì—°ê²°
- ì˜ˆ: `"1-2-1"` â†’ ìš´ë™+ì•½ë¬¼, ë‹¨ì‹ X
- ê²°ì¸¡ â†’ `"no_response"`

**ê°€ëŠ¥í•œ ì¡°í•© ì˜ˆì‹œ:**
- `"1-1-1"`: ìš´ë™ + ë‹¨ì‹ + ì•½ë¬¼ (ìœ„í—˜í•œ ë°©ë²•)
- `"1-2-2"`: ìš´ë™ë§Œ (ê±´ê°•í•œ ë°©ë²•)
- `"2-1-2"`: ë‹¨ì‹ë§Œ (ê±´ê°•í•˜ì§€ ì•ŠìŒ)

**ê°€ì„¤:**
ê±´ê°•í•œ ì²´ì¤‘ì¡°ì ˆ ë°©ë²•(ìš´ë™)ì„ ì‚¬ìš©í•˜ëŠ” ì‚¬ëŒì´ ê¸ˆì—° ì„±ê³µë¥  ë†’ìŒ

---

### 2. activity_score (ì‹ ì²´í™œë™ ì ìˆ˜)

**ëª©ì :** ì‹ ì²´í™œë™ ìˆ˜ì¤€ì´ ê±´ê°• ì˜ì‹ â†’ ê¸ˆì—° ì„±ê³µë¥ ì— ì˜í–¥

```python
def feature_activity_score_and_weight(df_merge):

    df_merge["activity_score_weight"] = (
        3 * df_merge["pha_04z1"].fillna(0) +
        2 * df_merge["pha_06z1"].fillna(0) +
        1 * df_merge["phb_01z1"].fillna(0)
    )
    # ê³ ê°•ë„, ì¤‘ê°•ë„, ê±·ê¸° í™œë™
    
    def activity_level(x):
        if x >= 10:
            return "high_activity"
        elif x >= 5:
            return "normal_activity"
        elif x >= 1:
            return "row_activity"
        else:
            return "no_activity"

    df_merge["activity_score"] = df_merge["activity_score_weight"].apply(activity_level)

    return df_merge
```

**ì›ë³¸ ë³€ìˆ˜:**
- `pha_04z1`: ê³ ê°•ë„ ì‹ ì²´í™œë™ (ì¼ìˆ˜)
- `pha_06z1`: ì¤‘ê°•ë„ ì‹ ì²´í™œë™ (ì¼ìˆ˜)
- `phb_01z1`: ê±·ê¸° í™œë™ (ì¼ìˆ˜)

**ë³€í™˜ ë¡œì§:**

1. **activity_score_weight (ê°€ì¤‘ ì ìˆ˜):**
   ```
   ì ìˆ˜ = 3 Ã— ê³ ê°•ë„ + 2 Ã— ì¤‘ê°•ë„ + 1 Ã— ê±·ê¸°
   ```
   - ê³ ê°•ë„ì— ê°€ì¥ ë†’ì€ ê°€ì¤‘ì¹˜ ë¶€ì—¬

2. **activity_score (ë²”ì£¼í™”):**
   - `â‰¥ 10`: `"high_activity"` (ê³ í™œë™)
   - `5-9`: `"normal_activity"` (ë³´í†µ)
   - `1-4`: `"row_activity"` (ì €í™œë™)
   - `0`: `"no_activity"` (ë¬´í™œë™)

**ê°€ì„¤:**
ì‹ ì²´í™œë™ì´ ë§ì€ ì‚¬ëŒì´ ê±´ê°• ì˜ì‹ ë†’ìŒ â†’ ê¸ˆì—° ì„±ê³µë¥  ë†’ìŒ

**ì˜ˆì‹œ:**
- ê³ ê°•ë„ 3ì¼ + ì¤‘ê°•ë„ 2ì¼ + ê±·ê¸° 1ì¼:
  ```
  ì ìˆ˜ = 3Ã—3 + 2Ã—2 + 1Ã—1 = 14
  â†’ "high_activity"
  ```

---

## í¡ì—° ê´€ë ¨ í•¨ìˆ˜ (ë³„ë„ ë¶„ë¥˜)

âš ï¸ **Liquid_method1, Liquid_method2ëŠ” í¡ì—° ë³€ìˆ˜ ì „ì²˜ë¦¬ í•¨ìˆ˜ì´ë¯€ë¡œ íŒŒìƒë³€ìˆ˜ ê°œìˆ˜ì—ì„œ ì œì™¸**

### Liquid_method2 (ì‚¬ìš© ì¤‘)

**ëª©ì :** ì•¡ìƒí˜• ë‹´ë°° í¡ì—°ìì˜ churn ì¬ì •ì˜

```python
def Liquid_method2(df_merge):
    # 9 ëª¨ë¦„ -> 2 ì•„ë‹ˆì˜¤ë¡œ ì²˜ë¦¬
    df_merge.loc[df_merge["sma_08z1"] == 9, 'sma_08z1'] = 2.0
    df_merge.loc[(df_merge['sma_08z1'] == 1) & (df_merge['sma_11z2'] != 0) & (df_merge['churn'] == 1), 'churn'] = 0
    return df_merge
```

**ë¡œì§:**
- ì•¡ìƒí˜• í¡ì—° ê²½í—˜ ìˆìŒ + ìµœê·¼ 1ê°œì›” í¡ì—° ì¼ìˆ˜ > 0 + churn = 1
  â†’ **churn = 0ìœ¼ë¡œ ë³€ê²½** (ì‹¤ì§ˆì  ê¸ˆì—° ì‹¤íŒ¨)

---

## ëª¨ë¸ í•™ìŠµ í™œìš© ë°©ì•ˆ

### 1. weight_control_method

```python
# ì²´ì¤‘ì¡°ì ˆ ë°©ë²•ë³„ ì„±ê³µë¥ 
df.groupby('weight_control_method')['churn'].mean()

# ë¹ˆë„ ë¶„ì„
df['weight_control_method'].value_counts()
```

### 2. activity_score

```python
# í™œë™ ìˆ˜ì¤€ë³„ ì„±ê³µë¥ 
df.groupby('activity_score')['churn'].mean()

# ìˆœì„œ: no < row < normal < high í™œë™
```

---

## ì°¸ê³ ì‚¬í•­

1. **ê°€ì¤‘ì¹˜ ê¸°ì¤€:**
   - ê³ ê°•ë„: 3ì 
   - ì¤‘ê°•ë„: 2ì 
   - ê±·ê¸°: 1ì 

2. **ë²”ì£¼ ë¶„ë¥˜ ê¸°ì¤€:**
   - 10ì  ì´ìƒ: ê³ í™œë™
   - 5-9ì : ë³´í†µ
   - 1-4ì : ì €í™œë™
   - 0ì : ë¬´í™œë™

3. **ìƒí˜¸ì‘ìš© ë¶„ì„:**
   - `activity_score` Ã— `weight_control_method`
   - ê±´ê°•í•œ ìƒí™œìŠµê´€ ì¡°í•©ì´ ê¸ˆì—° ì„±ê³µë¥ ì— ë¯¸ì¹˜ëŠ” ì˜í–¥

---

**ì‘ì„± ì™„ë£Œ:** 2025-10-14  
**ë²„ì „:** 1.0

